<!-- /Public/Base.html 〈修正後：フラグメント〉 -->
<header>
  <style>
    :root{ --header-h:64px; --text:#e6f1ff; --muted:#b8c6e0; --bg:rgba(10,16,30,.85); }
    *{box-sizing:border-box}
    header{
      position:sticky; top:0; z-index:1000;
      background:linear-gradient(180deg,var(--bg),rgba(10,16,30,.55));
      border-bottom:1px solid rgba(255,255,255,.06)
    }
    .wrap{max-width:1200px; margin:0 auto; padding:0 12px}
    .nav{
      display:flex; align-items:center; width:100%; gap:.6rem;
      height:var(--header-h)
    }
    .brand{display:inline-flex; align-items:center; gap:.55rem; font-weight:900; letter-spacing:.02em}
    .sp{flex:1}
    .navlinks{display:flex; gap:.25rem; align-items:center}
    .link{color:var(--text); text-decoration:none; padding:.45rem .7rem; border-radius:10px}
    .link:hover{background:rgba(255,255,255,.06)}
    .btn{
      display:inline-flex; align-items:center; gap:.4rem; padding:.5rem .8rem; border-radius:10px;
      border:1px solid rgba(255,255,255,.12); background:transparent; color:var(--text);
      text-decoration:none; font-weight:700; white-space:nowrap
    }
    .btn.primary{border:none; background:linear-gradient(180deg,#00bcd4,#2196f3); color:#fff}

    /* ハンバーガーボタン */
    .hamburger{
      display:none; width:40px; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
      background:transparent; color:var(--text); align-items:center; justify-content:center;
    }
    .hamburger:hover{background:rgba(255,255,255,.06)}
    .hamburger .bars{position:relative; width:20px; height:2px; background:currentColor; transition:transform .25s ease}
    .hamburger .bars::before,
    .hamburger .bars::after{
      content:""; position:absolute; left:0; width:20px; height:2px; background:currentColor; transition:transform .25s ease,opacity .2s ease, top .25s ease, bottom .25s ease
    }
    .hamburger .bars::before{top:-6px}
    .hamburger .bars::after{bottom:-6px}
    .hamburger[aria-expanded="true"] .bars{background:transparent}
    .hamburger[aria-expanded="true"] .bars::before{top:0; transform:rotate(45deg)}
    .hamburger[aria-expanded="true"] .bars::after{bottom:0; transform:rotate(-45deg)}

    /* モバイルメニュー（ドロップダウン） */
    .mobile-panel{
      display:none; /* 初期は非表示 */
      position:absolute; left:0; right:0; top:var(--header-h);
      background:rgba(10,16,30,.95);
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter:saturate(180%) blur(8px);
    }
    .mobile-panel.open{display:block}
    .mobile-panel .inner{padding:10px 12px 14px; max-width:1200px; margin:0 auto}
    .mobile-links{display:flex; flex-direction:column; gap:.25rem; margin-bottom:.5rem}
    .mobile-links .link{padding:.65rem .7rem}
    .mobile-actions{display:flex; gap:.5rem; flex-wrap:wrap}

    /* 900px以下でハンバーガー化 */
    @media (max-width:900px){
      .nav{height:var(--header-h)}
      .sp{flex:1}
      .navlinks{display:none}     /* PC用ナビは隠す */
      .actions{display:none}      /* PC用アクションも隠す */
      .hamburger{display:inline-flex; margin-left:auto}
    }
  </style>

  <div class="nav wrap" style="padding-left:0;padding-right:0">
    <div class="brand">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 2l2.39 4.84 5.34.78-3.86 3.76.91 5.31L12 14.77 7.22 16.69l.91-5.31L4.27 7.62l5.34-.78L12 2z" fill="currentColor" opacity=".95"/>
      </svg>
      <span>MCML</span>
    </div>

    <div class="sp"></div>

    <!-- PC用 -->
    <nav class="navlinks" aria-label="グローバルナビゲーション">
      <a class="link" href="/">ホーム</a>
      <a class="link" href="/Admin/admin.html">管理Doc</a>
    </nav>
    <div class="actions">
      <div id="welcome" class="link" style="display:none; font-weight:700;"></div>
      <a id="loginBtn" class="btn primary" href="/auth/discord/login">ログイン</a>
      <a id="logoutBtn" class="btn" href="/auth/logout" style="display:none">ログアウト</a>
    </div>

    <!-- スマホ用ハンバーガー -->
    <button id="hamburger" class="hamburger" aria-label="メニュー" aria-controls="mobilePanel" aria-expanded="false">
      <span class="bars" aria-hidden="true"></span>
    </button>
  </div>

  <!-- スマホ用ドロップダウンパネル（ナビ＋アクションを集約） -->
  <div id="mobilePanel" class="mobile-panel" role="dialog" aria-modal="false">
    <div class="inner">
      <nav class="mobile-links" aria-label="モバイルナビ">
        <a class="link" href="/">ホーム</a>
        <a class="link" href="/Admin/admin.html">管理Doc</a>
      </nav>
      <div class="mobile-actions">
        <div id="welcome_m" class="link" style="display:none; font-weight:700;"></div>
        <a id="loginBtn_m" class="btn primary" href="/auth/discord/login">ログイン</a>
        <a id="logoutBtn_m" class="btn" href="/auth/logout" style="display:none">ログアウト</a>
      </div>
    </div>
  </div>

  <script>
    // ハンバーガー開閉
    (() => {
      const btn = document.getElementById('hamburger');
      const panel = document.getElementById('mobilePanel');
      const toggle = () => {
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        panel.classList.toggle('open', !open);
        // スクロール固定（任意）
        document.body.style.overflow = !open ? 'hidden' : '';
      };
      btn.addEventListener('click', toggle);
      // パネル内リンクを押したら閉じる
      panel.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if (a) {
          btn.setAttribute('aria-expanded', 'false');
          panel.classList.remove('open');
          document.body.style.overflow = '';
        }
      });
    })();

    // /auth/me でセッション確認 → PC/モバイル両方の表示切替
    (async ()=>{
      try{
        const res = await fetch("/auth/me", {credentials:"include"});
        if(!res.ok) return;
        const me = await res.json();
        const name = me && me.ok ? (me.global_name || me.username || "") : null;

        const setState = (isLoggedIn) => {
          // PC側
          const w = document.getElementById("welcome");
          const login = document.getElementById("loginBtn");
          const logout = document.getElementById("logoutBtn");
          if(isLoggedIn){
            w.textContent = name ? `ようこそ ${name} さん` : "ログイン中";
            w.style.display = "inline-flex";
            login.style.display = "none";
            logout.style.display = "inline-flex";
          }else{
            w.style.display = "none";
            login.style.display = "inline-flex";
            logout.style.display = "none";
          }
          // モバイル側
          const wm = document.getElementById("welcome_m");
          const loginm = document.getElementById("loginBtn_m");
          const logoutm = document.getElementById("logoutBtn_m");
          if(isLoggedIn){
            wm.textContent = name ? `ようこそ ${name} さん` : "ログイン中";
            wm.style.display = "inline-flex";
            loginm.style.display = "none";
            logoutm.style.display = "inline-flex";
          }else{
            wm.style.display = "none";
            loginm.style.display = "inline-flex";
            logoutm.style.display = "none";
          }
        };

        setState(!!(me && me.ok));
      }catch(_e){}
    })();
  </script>
</header>
