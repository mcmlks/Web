<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MCML ホームページ</title>
  <meta name="description" content="MCMLはMinecraft好きが集まる日本のコミュニティ。お知らせ、イベント、サーバー情報、参加方法など。" />
  <meta property="og:title" content="MCML 公式ホームページ" />
  <meta property="og:description" content="Minecraft好きが集まる日本のコミュニティ。最新情報とイベントはこちら。" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#1f2937" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231f2937'/><text x='50' y='58' font-size='48' text-anchor='middle' fill='%23fff'>M</text></svg>">
  <style>
    /* ===== Reset ===== */
    *,*::before,*::after{box-sizing:border-box}
    html,body,h1,h2,h3,h4,p,ul,ol,li,figure,figcaption,blockquote,dl,dd{margin:0;padding:0}
    ul{list-style:none}
    img{max-width:100%;display:block}
    a{color:inherit;text-decoration:none}

    /* ===== Theme ===== */
    :root{
      --bg:#0b1020;
      --panel:#121b36;
      --panel-2:#0e152b;
      --text:#e5e7eb;
      --muted:#9aa4b2;
      --brand:#22d3ee;
      --brand-2:#34d399;
      --danger:#ef4444;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --gap:16px;
      --max:1100px;
      --card-w: clamp(240px, 30vw, 340px); /* 横スクのカード幅 */
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Helvetica, Arial, sans-serif;
      background:linear-gradient(180deg,#0b1020 0%, #0a0f1b 100%);
      color:var(--text); line-height:1.65
    }
    .container{width:min(var(--max), 92vw); margin-inline:auto}

    /* ===== Base.html 用（ヘッダー） ===== */
    header{position:sticky; top:0; z-index:40; backdrop-filter:blur(10px);
           background: color-mix(in oklab, #0b1020 80%, transparent);
           border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{display:flex; align-items:center; gap:14px; padding:12px 24px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px}
    .sp{flex:1}
    .navlinks{display:flex; gap:8px; flex-wrap:wrap}
    .link{display:inline-flex; padding:8px 10px; border-radius:10px}
    .link:hover{background:rgba(255,255,255,.06)}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px; background:var(--brand); color:#081019; font-weight:700; box-shadow:var(--shadow); border:0; cursor:pointer}
    .btn.secondary{background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.14)}

    /* ===== Hero ===== */
    .hero{position:relative; isolation:isolate; padding:64px 0 24px; overflow:hidden}
    .hero::before{content:""; position:absolute; inset:-20% -5% auto; height:60%; z-index:-1; background:
      conic-gradient(from 45deg at 20% 30%, rgba(34,211,238,.2), transparent 30%),
      radial-gradient(600px 300px at 80% -40%, rgba(52,211,153,.18), transparent 60%),
      radial-gradient(500px 320px at -20% 20%, rgba(34,211,238,.15), transparent 60%);
      filter: blur(12px); opacity:.9}
    .hero-grid{display:grid; grid-template-columns:1.2fr .8fr; gap:28px}
    .hero h1{font-size:clamp(28px, 5vw, 48px); line-height:1.15; letter-spacing:.2px}
    .hero p.lead{margin-top:12px; color:var(--muted)}
    .cta{display:flex; gap:12px; margin-top:18px; flex-wrap:wrap}

    /* ===== Sections / Cards ===== */
    .card{background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .content{padding:18px}
    section{padding:34px 0}
    section h2{font-size:clamp(20px, 3.6vw, 28px); margin-bottom:14px}
    .grid{display:grid; gap:var(--gap)}
    .grid.cols-3{grid-template-columns:repeat(3, 1fr)}
    .grid.cols-2{grid-template-columns:repeat(2, 1fr)}
    @media (max-width: 900px){
      .hero-grid{grid-template-columns:1fr}
      .grid.cols-3{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 640px){
      .grid.cols-3,.grid.cols-2{grid-template-columns:1fr}
    }

    /* ===== Gallery ===== */
    .imgcard{position:relative; overflow:hidden; border-radius:14px; border:1px solid rgba(255,255,255,.08); background:#0e152b; cursor:pointer}
    .imgwrap{aspect-ratio:16/9; width:100%; position:relative; overflow:hidden}
    .imgwrap img{width:100%; height:100%; object-fit:cover; display:block; transition:transform .3s ease}
    .imgcard:hover img{transform:scale(1.03)}
    .imgcap{padding:10px 12px; color:var(--muted); font-size:14px; border-top:1px solid rgba(255,255,255,.06)}
    .imgph{width:100%; height:100%; display:grid; place-items:center; color:#9aa4b2; font-size:12px; background:linear-gradient(180deg,#101a33,#0e152b)}

    .hscroll{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:var(--card-w);
      gap:var(--gap);
      overflow-x:auto;
      padding-bottom:6px;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch
    }
    .hscroll.autoscrolling{scroll-snap-type:none;} /* 自動中はsnap無効 */
    .hscroll::-webkit-scrollbar{height:8px}
    .hscroll > *{scroll-snap-align:start}
    .autoScrollHint{color:var(--muted); font-size:12px; margin-top:8px}

    /* ===== Lightbox ===== */
    .lightbox{position:fixed; inset:0; background:rgba(5,8,15,.75); display:none; align-items:center; justify-content:center; z-index:1000; backdrop-filter:blur(3px)}
    .lightbox.open{display:flex}
    .lb-inner{position:relative; width:min(96vw,1100px); max-height:90vh; display:grid; grid-template-rows:auto 1fr auto; gap:8px}
    .lb-media{background:#0b1224; border:1px solid rgba(255,255,255,.12); border-radius:14px; overflow:hidden; display:grid; place-items:center}
    .lb-media img{width:100%; height:100%; object-fit:contain; background:#0b1224}
    .lb-caption{display:flex; justify-content:space-between; gap:12px; align-items:center; color:#c8d0dc; font-size:14px}
    .lb-actions{position:absolute; inset:auto 0 50% 0; transform:translateY(50%); display:flex; justify-content:space-between; pointer-events:none}
    .lb-btn{pointer-events:auto; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18); color:#fff; width:44px; height:44px; display:grid; place-items:center; border-radius:10px; cursor:pointer}
    .lb-btn:hover{background:rgba(0,0,0,.6)}
    .lb-close{position:absolute; top:-12px; right:-12px; width:40px; height:40px; border-radius:999px; background:rgba(0,0,0,.65); border:1px solid rgba(255,255,255,.18); color:#fff; display:grid; place-items:center; cursor:pointer}
    @media (max-width:640px){
      .lb-inner{width:96vw}
      .lb-actions{inset:auto 6px 50% 6px}
    }

    footer{padding:28px 0 48px; color:var(--muted); border-top:1px solid rgba(255,255,255,.08)}
    .footer-grid{display:grid; grid-template-columns:1fr 1fr; gap:18px}
    .tiny{font-size:12px; opacity:.8}
    .pill{display:inline-block; padding:6px 10px; border:1px solid rgba(255,255,255,.12); border-radius:999px; font-size:12px; opacity:.9}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:12px; background:rgba(255,255,255,.05); padding:2px 6px; border-radius:6px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <!-- 共通ヘッダー -->
  <!--#include "/Public/Base.html" -->

  <!-- ===== Hero ===== -->
  <section class="hero">
    <div class="container hero-grid">
      <div>
        <span class="pill">マインクラフトマルチ連盟</span>
        <h1>マイクラ好きがつながる場所<br/>MCML</h1>
        <p class="lead">～初心者から上級さんまで歓迎～</p>
        <p class="lead">Ver3.0</p>
        <div class="cta">
          <a class="btn" href="#discord" aria-label="コミュニティに参加する">参加する
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M5 12h14M13 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </a>
          <a class="btn secondary" href="#minecraft">サーバー一覧</a>
          <a class="btn secondary" href="#features">特長</a>
          <a class="btn secondary" href="/#gallery">ギャラリー</a>
          <a class="btn secondary" href="/#discord">参加</a>
          <a class="btn secondary" href="/#faq">FAQ</a>
        </div>
      </div>
      <aside class="card">
        <div class="content">
          <h3 style="margin-bottom:8px">最近のハイライト</h3>
          <ul style="display:grid; gap:10px">
            <li>2025年08月02日 夏祭り-文化祭イベント</li>
            <li>2024年12月22日 クリスマスイベント</li>
            <li>2024年11月16日 釣り大会</li>
            <li>2024年10月31日 ハロウィン写真コンテスト</li>
          </ul>
        </div>
      </aside>
    </div>
  </section>

  <!-- ===== Features ===== -->
  <section id="features">
    <div class="container">
      <h2>特長</h2>
      <div class="grid cols-3" style="margin-top:10px">
        <article class="card"><div class="content"><h3>みんなでワイワイ</h3><p class="muted">一人で進めたい方やみんなで楽しくマルチを楽しみたい方が集まっています</p></div></article>
        <article class="card"><div class="content"><h3>優しいメンバー</h3><p class="muted">新規さんや初心者さんはもちろん、みんなが優しく教え合ったり楽しくマルチをしています</p></div></article>
        <article class="card"><div class="content"><h3>イベント</h3><p class="muted">数ヶ月に1度ミニイベントを開催！年に大規模イベント2～5回を開催！（夏祭り、クリスマス、ハロウィン、年末、釣り大会など）</p></div></article>
      </div>
    </div>
  </section>

  <!-- ===== Gallery ===== -->
  <section id="gallery">
    <div class="container">
      <h2>ギャラリー</h2>
      <div id="galleryGrid" class="grid cols-3" style="margin-top:10px"></div>
      <div id="galleryHScroll" class="hscroll" style="margin-top:10px; display:none"></div>
      <p class="autoScrollHint" id="autoScrollHint" style="display:none">写真が多いため自動で横スクロールしています。ホバーで一時停止できます。</p>
      <p class="muted" style="margin-top:8px">※ 画像リストは <code>/Public/ギャラリー写真追加用.txt</code> または <code>/Public/gallery.txt</code> を編集してください。</p>
    </div>
  </section>

  <!-- ===== Discord ===== -->
  <section id="discord">
    <div class="container">
      <h2>参加方法</h2>
      <div class="card" style="margin-top:10px"><div class="content">
        <ol style="display:grid; gap:10px; padding-left:18px">
          <li>公式Discordに参加（招待リンクをクリック）</li>
          <li>Minecraft Java版またはBedrock版を用意</li>
          <li>ルールを確認して好きなサーバーにログイン</li>
        </ol>
        <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap">
          <a class="btn" id="openInvite" href="#" rel="noopener">招待リンクを開く</a>
          <a class="btn secondary" id="copyInvite" href="#">招待リンクをコピー</a>
        </div>
        <p class="muted" style="margin-top:8px">不明点はDiscordでお気軽にご質問ください。</p>
        <p class="muted" id="inviteText" style="margin-top:6px; word-break:break-all"><span class="kbd">YOUR_DISCORD_INVITE_URL</span></p>
      </div></div>
    </div>
  </section>

  <!-- ===== Minecraft ===== -->
  <section id="minecraft">
    <div class="container">
      <h2>サーバーリスト</h2>
      <div class="grid cols-3" style="margin-top:10px">
        <article class="card"><div class="content"><h3>永久鯖(サバイバルサーバー)</h3><p class="muted">永遠に変わることのないサバイバルサーバー。</p><p>アドレス：<span class="kbd">記載なし</span></p></div></article>
        <article class="card"><div class="content"><h3>シーズンサーバー</h3><p class="muted">大型アップデートなどでワールドが変わるシーズン型サーバー</p><p><span class="kbd"></span></p></div></article>
        <article class="card"><div class="content"><h3>MCMLKC</h3><p class="muted">建築専用クリエイティブサーバー</p><p><span class="kbd"></span></p></div></article>
        <article class="card"><div class="content"><h3>MCMLKCR</h3><p class="muted">レッドストーン専用クリエイティブサーバー</p><p><span class="kbd"></span></p></div></article>
      </div>
    </div>
  </section>

  <!-- ===== FAQ ===== -->
  <section id="faq">
    <div class="container">
      <h2>FAQ</h2>
      <div class="card" style="margin-top:10px"><div class="content">
        <dl>
          <dt><strong>いつ活動していますか？</strong></dt>
          <dd class="muted">24時間いつでも参加可能です！</dd>
          <dt style="margin-top:10px"><strong>サイトの内容は誰が更新？</strong></dt>
          <dd class="muted">コミュニティーの方が編集リクエストし、変更が可能です</dd>
        </dl>
      </div></div>
    </div>
  </section>

  <!-- ===== Lightbox ===== -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lb-inner">
      <div class="lb-media"><img id="lbImg" alt="拡大画像" decoding="async"></div>
      <div class="lb-caption">
        <span id="lbText" class="muted"></span>
        <span id="lbIndex" class="muted"></span>
      </div>
      <button class="lb-close" id="lbClose" aria-label="閉じる">✕</button>
      <div class="lb-actions">
        <button class="lb-btn" id="lbPrev" aria-label="前へ">‹</button>
        <button class="lb-btn" id="lbNext" aria-label="次へ">›</button>
      </div>
    </div>
  </div>

  <!-- ===== Footer ===== -->
  <footer>
    <div class="container footer-grid">
      <div>
        <strong>MCML</strong>
        <p class="tiny">© <span id="year"></span> MCML Community. 非公式のMinecraftコミュニティーサイトです。Minecraft は Mojang Studios の商標です。</p>
      </div>
      <div style="text-align:right">
        <a class="pill" href="#top">トップへ戻る ↑</a>
      </div>
    </div>
  </footer>

  <!-- ===== Scripts ===== -->
  <script>
  /* ================= 設定 ================= */
  const GALLERY_TXT_SOURCES = [
    "/Public/ギャラリー写真追加用.txt",
    "/Public/gallery.txt",
    "ギャラリー写真追加用.txt",
    "gallery.txt",
  ];
  const DISCORD_INVITE_URL = "YOUR_DISCORD_INVITE_URL";

  const AUTOSCROLL_ALWAYS = true;
  const SCROLL_STEP_PX = 1.5;
  const FORCE_SCROLL_MIN = 4;
  const IGNORE_REDUCED_MOTION = true;
  const RUN_ONLY_WHEN_VISIBLE = true;
  /* ======================================= */

  // 年表示 & 招待リンク
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('inviteText').innerHTML = `<span class="kbd">${DISCORD_INVITE_URL}</span>`;
  document.getElementById('openInvite').addEventListener('click', (e)=>{
    e.preventDefault(); window.open(DISCORD_INVITE_URL, "_blank", "noopener,noreferrer");
  });
  document.getElementById('copyInvite').addEventListener('click', (e)=>{
    e.preventDefault(); navigator.clipboard.writeText(DISCORD_INVITE_URL).then(()=>alert("招待リンクをコピーしました"));
  });

  // ====== ギャラリー ======
  const grid   = document.getElementById('galleryGrid');
  const strip  = document.getElementById('galleryHScroll');
  const hint   = document.getElementById('autoScrollHint');

  async function fetchTexts(urls){
    const results = [];
    await Promise.all(urls.map(async (u) => {
      try{
        const res = await fetch(u, { cache:"no-store", credentials:"same-origin" });
        if(res.ok){
          const t = await res.text();
          if(t.trim()) results.push({ url: u, text: t });
        }else{
          console.warn("[gallery] fetch NG", u, res.status);
        }
      }catch(err){
        console.warn("[gallery] fetch error", u, err);
      }
    }));
    return results;
  }

  function parseGalleryTxt(text){
    const items = [];
    for(let raw of text.split(/\r?\n/)){
      let line = raw.trim();
      if(!line) continue;
      if(/^(#|;|\/\/)/.test(line)) continue;
      line = line.replace(/\s+(#|;|\/\/).*$/, "").trim();
      if(!line) continue;

      let url="", cap="";
      let m = line.match(/^\s*([^,|]+)\s*[,|]\s*(.+)\s*$/);
      if(m){ url=m[1].trim(); cap=m[2].trim(); }
      else if( (m=line.match(/^\s*(\S+)\s+-\s+(.+)\s*$/)) ){
        url=m[1]; cap=m[2].trim();
      }else{
        const sp = line.indexOf(" ");
        if(sp>0){ url=line.slice(0,sp).trim(); cap=line.slice(sp+1).trim(); }
        else { url=line; cap=""; }
      }
      if(url) items.push({src:url, caption:cap});
    }
    return items;
  }

  function mergeItems(listOfItems){
    const seen = new Map();
    for(const arr of listOfItems){
      for(const it of arr){
        if(!seen.has(it.src)){
          seen.set(it.src, it);
        }else{
          const cur = seen.get(it.src);
          if((!cur.caption || cur.caption.length < (it.caption||"").length) && it.caption){
            seen.set(it.src, it);
          }
        }
      }
    }
    return Array.from(seen.values());
  }

  function safeHost(u){ try{ return new URL(u).hostname }catch{ return "" } }

  function makeCard(item, idx){
    const card = document.createElement('article');
    card.className = 'imgcard';
    card.setAttribute('data-index', idx);

    const wrap = document.createElement('div');
    wrap.className = 'imgwrap';

    const ph = document.createElement('div');
    ph.className = 'imgph';
    ph.textContent = '読み込み中…';
    wrap.appendChild(ph);

    const img = document.createElement('img');
    img.loading = 'lazy';
    img.decoding = 'async';
    img.alt = item.caption || 'MCML ギャラリー画像';
    img.src = item.src;
    img.addEventListener('load', ()=> wrap.replaceChildren(img));
    img.addEventListener('error', ()=> { ph.textContent = '画像を表示できませんでした'; wrap.replaceChildren(ph); });

    const cap = document.createElement('div');
    cap.className = 'imgcap';
    cap.textContent = item.caption || safeHost(item.src) || '';

    card.appendChild(wrap);
    card.appendChild(cap);
    card.addEventListener('click', ()=> openLightbox(idx));
    return card;
  }

  function layoutAndMaybeScroll(items){
    if(!items.length){
      grid.innerHTML = '<p class="muted">ギャラリーリストが空です。/Public/gallery.txt を編集してください。</p>';
      return;
    }
    grid.innerHTML = "";
    items.forEach((it, i)=> grid.appendChild(makeCard(it, i)));

    requestAnimationFrame(()=>{
      const card = grid.querySelector('.imgcard');
      const w = card ? card.getBoundingClientRect().width : 280;
      const needed = (w + 16) * items.length;
      const visible = grid.getBoundingClientRect().width;

      const shouldScroll = AUTOSCROLL_ALWAYS || items.length >= FORCE_SCROLL_MIN || needed > visible * 0.95;

      if(shouldScroll){
        strip.innerHTML = "";
        items.forEach((it, i)=> strip.appendChild(makeCard(it, i)));
        grid.style.display = 'none';
        strip.style.display = 'grid';
        hint.style.display  = 'block';
        strip.classList.add('autoscrolling'); // snap無効化
        startAutoScroll();
      }else{
        grid.style.display = '';
        strip.style.display = 'none';
        hint.style.display  = 'none';
        strip.classList.remove('autoscrolling');
      }
    });
  }

  // ===== Lightbox =====
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lbImg');
  const lbText = document.getElementById('lbText');
  const lbIndex = document.getElementById('lbIndex');
  const btnPrev = document.getElementById('lbPrev');
  const btnNext = document.getElementById('lbNext');
  const btnClose= document.getElementById('lbClose');
  let gallery = [], cur = 0, autoTimer=null, paused=false, wheelTimer=null;

  function showAt(i){
    cur = (i + gallery.length) % gallery.length;
    const it = gallery[cur];
    lbImg.src = '';
    lbImg.src = it.src;
    lbText.textContent = it.caption || safeHost(it.src) || '';
    lbIndex.textContent = `${cur+1} / ${gallery.length}`;
    const pre1 = new Image(); pre1.src = gallery[(cur+1)%gallery.length].src;
    const pre2 = new Image(); pre2.src = gallery[(cur-1+gallery.length)%gallery.length].src;
  }
  function openLightbox(i){ lb.classList.add('open'); document.body.style.overflow='hidden'; pauseAutoScroll(); showAt(i); }
  function closeLightbox(){ lb.classList.remove('open'); document.body.style.overflow=''; resumeAutoScroll(); }
  btnPrev.addEventListener('click', e=>{ e.stopPropagation(); showAt(cur-1); });
  btnNext.addEventListener('click', e=>{ e.stopPropagation(); showAt(cur+1); });
  btnClose.addEventListener('click', e=>{ e.stopPropagation(); closeLightbox(); });
  lb.addEventListener('click', e=>{ if(e.target===lb) closeLightbox(); });
  document.addEventListener('keydown', e=>{
    if(!lb.classList.contains('open')) return;
    if(e.key==='Escape') closeLightbox();
    if(e.key==='ArrowLeft') showAt(cur-1);
    if(e.key==='ArrowRight') showAt(cur+1);
  });

  // ===== 自動横スクロール =====
  function startAutoScroll(){
    if(autoTimer) return;
    const el = strip;

    const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if(reduceMotion && !IGNORE_REDUCED_MOTION) return;

    let visible = true;
    let io = null;
    if (RUN_ONLY_WHEN_VISIBLE) {
      io = new IntersectionObserver((entries)=>{
        visible = entries.some(e => e.isIntersecting);
      }, { root: null, threshold: 0.01 });
      io.observe(el);
    }

    const step = SCROLL_STEP_PX;

    function tick(){
      if(paused || (RUN_ONLY_WHEN_VISIBLE && !visible)){
        autoTimer = requestAnimationFrame(tick);
        return;
      }
      const max = el.scrollWidth - el.clientWidth;

      if(max <= 0){
        requestAnimationFrame(()=>{
          const max2 = el.scrollWidth - el.clientWidth;
          if(max2 <= 0){
            cancelAnimationFrame(autoTimer);
            autoTimer = null;
            if(io) io.disconnect();
            el.classList.remove('autoscrolling');
          }else{
            autoTimer = requestAnimationFrame(tick);
          }
        });
        return;
      }

      el.scrollLeft += step;
      if(el.scrollLeft >= max - 2){ el.scrollLeft = 0; }
      autoTimer = requestAnimationFrame(tick);
    }

    // display切替直後の計測ズレ対策
    requestAnimationFrame(()=>{ autoTimer = requestAnimationFrame(tick); });

    // 停止中もsnapはOFFのまま（位置が戻らない）
    function pause(){ paused = true; }
    function resume(){ paused = false; el.classList.add('autoscrolling'); }

    // エクスポート（ライトボックスから呼ぶ）
    window.__galleryPause = pause;
    window.__galleryResume = resume;

    el.addEventListener('mouseenter', pause);
    el.addEventListener('mouseleave', resume);
    el.addEventListener('touchstart', pause, {passive:true});
    el.addEventListener('touchend',   resume);
    el.addEventListener('wheel', ()=>{
      pause();
      clearTimeout(wheelTimer);
      wheelTimer = setTimeout(resume, 1200);
    }, {passive:true});
  }

  // ライトボックスからの一時停止/再開フック
  function pauseAutoScroll(){ if(window.__galleryPause) window.__galleryPause(); }
  function resumeAutoScroll(){ if(window.__galleryResume) window.__galleryResume(); }

  // ===== 初期化 =====
  (async ()=>{
    const texts = await fetchTexts(GALLERY_TXT_SOURCES);
    const parsedLists = texts.map(x => parseGalleryTxt(x.text));
    if(parsedLists.length === 0){
      grid.innerHTML = '<p class="muted">ギャラリーリストが見つかりません。/Public/gallery.txt を用意してください。</p>';
      return;
    }
    gallery = mergeItems(parsedLists);
    layoutAndMaybeScroll(gallery);
  })();

  // スムーズスクロール
  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a[href^="#"]');
    if(!a) return;
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if(el){
      e.preventDefault();
      el.scrollIntoView({ behavior:'smooth', block:'start' });
    }
  });
  </script>
</body>
</html>
